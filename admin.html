<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Management</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body >
    <nav class="relative px-4 py-4 flex justify-between items-center bg-white shadow-md">
        <a class="text-3xl font-bold leading-none" href="#">
          <img class="h-20 w-30" alt="logo" src="img/logo2.png">
      </a>
        <div class="lg:hidden">
            <button class="navbar-burger flex items-center text-blue-600 p-3">
                <svg class="block h-4 w-4 fill-current" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                    <title>Mobile menu</title>
                    <path d="M0 3h20v2H0V3zm0 6h20v2H0V9zm0 6h20v2H0v-2z"></path>
                </svg>
            </button>
        </div>
        <ul class="hidden absolute top-1/2 left-1/2 transform -translate-y-1/2 -translate-x-1/2 lg:flex lg:mx-auto lg:flex lg:items-center lg:w-auto lg:space-x-6">
            <li><a class="text-sm text-gray-800 hover:text-gray-500" href="#" onclick="makeBold(event)">Home</a></li>
            <li class="text-gray-300">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" class="w-4 h-4 current-fill" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 5v0m0 7v0m0 7v0m0-13a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z" />
                </svg>
            </li>
            <li><a class="text-sm text-gray-800 hover:text-gray-500" href="admin.html" onclick="makeBold(event)">Product</a></li>
            <li class="text-gray-300">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" class="w-4 h-4 current-fill" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 5v0m0 7v0m0 7v0m0-13a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z" />
                </svg>
            </li>
            <li><a class="text-sm text-gray-800 hover:text-gray-500" href="categories.html" onclick="makeBold(event)">Category</a></li>
            <li class="text-gray-300">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" class="w-4 h-4 current-fill" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 5v0m0 7v0m0 7v0m0-13a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z" />
                </svg>
            </li>
      
           
        </ul>
       
    </nav>
    <div class="container mx-auto px-2 py-8">
        <div class="w-full mx-auto">
            <div class="grid grid-cols-2 gap-4 px-5 py-2">
                <div>
                    <label for="name" class="block mb-2 text-sm font-medium text-gray-900">Name</label>
                    <input type="text" placeholder="Name of Product" id="name" 
                    class="border border-gray-200 rounded-lg w-full px-5 py-2">
                </div>
                <div>
                    <label for="price" class="block mb-2 text-sm font-medium text-gray-900">Price</label>
                    <input type="number" placeholder="Price of Product" id="price" 
                    class="border border-gray-200 rounded-lg w-full px-5 py-2">
                </div>
                <div>
                    <label for="category" class="block mb-2 text-sm font-medium text-gray-900">Category</label>
                    <select id="category" 
                    class="border border-gray-200 rounded-lg w-full px-5 py-2">
                        <!-- Options will be populated dynamically -->
                    </select>
                </div>
                 <div>
                    <label for="image" class="block mb-2 text-sm font-medium text-gray-900">File</label>
                    <input type="file" accept="image/*" id="image" 
                    class="w-full border border-gray-200 rounded-lg px-5 py-2">
                </div>
                <div>
                    <label for="description" class="block mb-2 text-sm font-medium text-gray-900">Description</label>
                    <textarea id="description" rows="3" placeholder="Description" 
                    class="border border-gray-200 rounded-lg w-full px-5 py-2"></textarea>
                </div>
               
                <div class="flex items-end">
                    <button type="button" id="save" onclick="SaveProduct()" 
                    class="text-white bg-gray-700 hover:bg-gray-800 focus:ring-4 focus:ring-gray-400 font-medium rounded-lg 
                    text-sm px-5 py-2">Save</button>
                </div>
            </div>
            <div class="overflow-x-auto px-8 py-8">
                <header class="px-5 py-4 border-b border-gray-100 bg-gray-200 rounded-lg p-1">
                    <h2 class="font-semibold text-gray-800">Stuff Management.</h2>
                </header>
                <table class="w-full bg-white shadow-md rounded-xl">
                    <thead>
                        <tr>
                            <th scope="col" class="px-6 py-3">Image</th>
                            <th scope="col" class="px-6 py-3">Name</th>
                            <th scope="col" class="px-6 py-3">Description</th>
                            <th scope="col" class="px-6 py-3">Category</th>
                            <th scope="col" class="px-6 py-3">Price</th>
                            <th scope="col" class="text-center">Action</th>
                        </tr>
                    </thead>
                    <tbody id="result" class="bg-white dark:bg-gray-800"></tbody>
                </table>
                <div id="pagination" class="flex justify-center mt-4">
                    <button id="previousButton" onclick="previousPage()" class="px-2 py-1 mx-1 bg-gray-200 text-gray-700 rounded hover:bg-gray-300 text-sm hidden">Previous</button>
                    <button id="nextButton" onclick="nextPage()" class="px-2 py-1 mx-1 bg-gray-200 text-gray-700 rounded hover:bg-gray-300 text-sm hidden">Next</button>
                </div>
            </div>
        </div>
    </div>
    
    
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script>
        let currentPage = 1;
        const itemsPerPage = 5;
        let products = [];
        let categories = [];

        const convertToBase64 = (file) => {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result);
                reader.onerror = error => reject(error);
            });
        }

        const GetProducts = async () => {
            await axios.get('http://localhost:3000/products')
                .then((response) => {
                    products = response.data;
                    displayProducts(currentPage);
                    updatePagination();
                })
                .catch((error) => {
                    alert(error.message);
                });
        }

        const GetCategories = async () => {
            await axios.get('http://localhost:3000/categories')
                .then((response) => {
                    categories = response.data;
                    let options = '';
                    categories.forEach((category) => {
                        options += `<option value="${category.id}">${category.name}</option>`;
                    });
                    document.getElementById('category').innerHTML = options;
                })
                .catch((error) => {
                    alert(error.message);
                });
        }

        const displayProducts = (page) => {
            const start = (page - 1) * itemsPerPage;
            const end = start + itemsPerPage;
            const paginatedProducts = products.slice(start, end);

            let bucket = '';
            paginatedProducts.forEach((product) => {
                const categoryName = categories.find(cat => cat.id === product.category)?.name || 'Unknown';
                bucket += `
                    <tr class="bg-white border-b dark:bg-gray-800 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600">
                        <td class="p-4">
                            <img src="${product.image}" class="w-16 md:w-32 max-w-full max-h-full" alt="${product.name}">
                        </td>
                        <td class="px-6 py-4 font-semibold text-gray-900 dark:text-white">${product.name}</td>
                        <td class="px-6 py-4 font-semibold text-gray-900 dark:text-white">${product.description}</td>
                        <td class="px-6 py-4 font-semibold text-gray-900 dark:text-white">${categoryName}</td>
                        <td class="px-6 py-4 font-semibold text-gray-900 dark:text-white">Rp${product.price}</td>
                        <td class="px-6 py-4">
                            <div class="inline-flex rounded-md shadow-sm" role="group">
                                <button type="button" class="text-white bg-yellow-400 hover:bg-yellow-500 rounded-lg text-sm px-5 py-2.5 mr-2 mb-2 " onclick="EditProduct('${product.id}')">Update</button>
                                <button type="button" class="text-white bg-red-700 hover:bg-red-800 rounded-lg text-sm px-5 py-2.5 mb-2" onclick="DeleteProduct('${product.id}')">Delete</button>
                            </div>
                        </td>
                    </tr>
                `;
            });
            document.getElementById('result').innerHTML = bucket;
        }

        const updatePagination = () => {
            const totalPages = Math.ceil(products.length / itemsPerPage);
            let paginationHTML = '';

            if (currentPage > 1) {
                paginationHTML += `<button onclick="previousPage()" class="px-2 py-1 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400">Previous</button>`;
            }

            if (currentPage < totalPages) {
                paginationHTML += `<button onclick="nextPage()" class="px-2 py-1 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400">Next</button>`;
            }

            document.getElementById('pagination').innerHTML = paginationHTML;
        }

        const previousPage = () => {
            if (currentPage > 1) {
                currentPage--;
                displayProducts(currentPage);
                updatePagination();
            }
        }

        const nextPage = () => {
            const totalPages = Math.ceil(products.length / itemsPerPage);
            if (currentPage < totalPages) {
                currentPage++;
                displayProducts(currentPage);
                updatePagination();
            }
        }

        const SaveProduct = async () => {
            let name = document.getElementById('name').value;
            let price = document.getElementById('price').value;
            let description = document.getElementById('description').value;
            let imageFile = document.getElementById('image').files[0];
            let category = document.getElementById('category').value;

            if (imageFile) {
                const imageBase64 = await convertToBase64(imageFile);
                const confirmSave = confirm('Are you sure you want to save this product?');
                if (confirmSave) {
                    await axios.post('http://localhost:3000/products', {
                        name: name,
                        price: price,
                        description: description,
                        image: imageBase64,
                        category: category,
                    })
                    .then((response) => {
                        GetProducts();
                        ClearInputs();
                    })
                    .catch((error) => {
                        alert(error.message);
                    });
                }
            } else {
                alert('Please select an image.');
            }
        }

        const EditProduct = async (id) => {
            await axios.get(`http://localhost:3000/products/${id}`)
                .then((response) => {
                    const product = response.data;
                    document.getElementById("name").value = product.name;
                    document.getElementById("price").value = product.price;
                    document.getElementById("description").value = product.description;
                    document.getElementById("image").value = '';
                    document.getElementById("category").value = product.category;
                    document.getElementById("save").innerText = "Update";
                    document.getElementById("save").setAttribute('onclick', `UpdateProduct('${id}')`);
                })
                .catch((error) => {
                    alert(error.message);
                })
        }

        const UpdateProduct = async (id) => {
            let name = document.getElementById('name').value;
            let price = document.getElementById('price').value;
            let description = document.getElementById('description').value;
            let imageFile = document.getElementById('image').files[0];
            let category = document.getElementById('category').value;

            let updatedProduct = {
                name: name,
                price: price,
                description: description,
                category: category,
            };

            if (imageFile) {
                const imageBase64 = await convertToBase64(imageFile);
                updatedProduct.image = imageBase64;
            }

            const confirmUpdate = confirm('Are you sure you want to update this product?');
            if (confirmUpdate) {
                try {
                    await axios.patch(`http://localhost:3000/products/${id}`, updatedProduct);
                    document.getElementById("save").innerText = "Save";
                    document.getElementById("save").setAttribute('onclick', `SaveProduct()`);
                    ClearInputs();
                    GetProducts();
                } catch (error) {
                    alert(error.message);
                }
            }
        };


        const DeleteProduct = async (id) => {
            const confirmDelete = confirm('Are you sure you want to delete this product?');
            if (confirmDelete) {
                await axios.delete(`http://localhost:3000/products/${id}`)
                    .then((response) => {
                        GetProducts();
                    })
                    .catch((error) => {
                        alert(error.message);
                    })
            }
        }

        const ClearInputs = () => {
            document.getElementById('name').value = '';
            document.getElementById('price').value = '';
            document.getElementById('description').value = '';
            document.getElementById('image').value = '';
            document.getElementById('category').selectedIndex = 0;
        }

        document.addEventListener('DOMContentLoaded', () => {
            GetCategories();
            GetProducts();
        });
    </script>
</body>
</html>
